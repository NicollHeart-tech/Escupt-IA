<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Escupt IA</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: #2a004f;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        #sidebar { 
            width: 260px;
            background: #4b0082;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .new-chat-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        #history {
            flex: 1;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .history-item:hover {
            background: rgba(255,255,255,0.1);
        }

        #main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #welcome {
            text-align: center;
            margin-top: 25vh;
        }

        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 80px 20px 150px;
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .user {
            align-self: flex-end;
            background: #6d28d9;
            color: white;
        }

        .ai {
            align-self: flex-start;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        #inputArea {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: #2a004f;
        }

        #input {
            width: 100%;
            max-width: 800px;
            padding: 15px;
            background: #3d0070;
            border: 1px solid #6d28d9;
            border-radius: 30px;
            color: white;
            outline: none;
            font-size: 16px;
            margin: 0 auto;
            display: block;
        }

        @media (max-width: 768px) {
            #sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>

    <aside id="sidebar">
        <button class="new-chat-btn" onclick="newChat()">+ Nova conversa</button>
        <div id="history"></div>
    </aside>

    <main id="main">
        <div id="welcome">
            <h1>Escupt IA</h1>
            <p>Como posso ajudar?</p>
        </div>

        <div id="chat"></div>

        <div id="inputArea">
            <input type="text" id="input" placeholder="Escreva aqui..." />
        </div>
    </main>

    <script>
        const API = "https://chorographically-nonallegiance-rubye.ngrok-free.dev";
        let chats = [];
        let current = null;

        function newChat() {
            current = null;
            document.getElementById('chat').innerHTML = '';
            document.getElementById('chat').style.display = 'none';
            document.getElementById('welcome').style.display = 'block';
        }

        function addMsg(text, type) {
            const div = document.createElement('div');
            div.className = 'message ' + type;
            div.textContent = text;
            document.getElementById('chat').appendChild(div);
            document.getElementById('chat').scrollTop = 999999;
            return div;
        }

        async function send(text) {
            if (!text.trim()) return;

            if (!current) {
                current = Date.now();
                chats.push({ id: current, title: text.substring(0, 20), msgs: [] });
                updateHistory();
            }

            document.getElementById('welcome').style.display = 'none';
            document.getElementById('chat').style.display = 'flex';

            addMsg(text, 'user');
            const aiDiv = addMsg('Pensando...', 'ai');

            try {
                const res = await fetch(API + '/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "EscuptIA_Oficial",
                        prompt: text,
                        stream: false
                    })
                });

                const data = await res.json();
                aiDiv.textContent = data.response || 'Erro na resposta';

            } catch (err) {
                aiDiv.textContent = 'Erro: ' + err.message;
            }
        }

        function updateHistory() {
            const h = document.getElementById('history');
            h.innerHTML = '';
            chats.slice().reverse().forEach(c => {
                const d = document.createElement('div');
                d.className = 'history-item';
                d.textContent = c.title;
                d.onclick = () => current = c.id;
                h.appendChild(d);
            });
        }

        document.getElementById('input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                send(e.target.value);
                e.target.value = '';
            }
        });
    </script>

</body>
</html>
